<html>
<head>
    <meta charset="UTF-8" />
    <title>Graphix</title>
    <style>
        body {margin: 0;}
        canvas {width: 100%; height: 100%}
    </style>
</head>
<body>
    <script src="js/three.js"></script>
    <script src="js/GLTFLoader.js"></script>
    <script src="js/TextureLoader.js"></script>
    <script>
        var scene = new THREE.Scene(); 
        scene.background = new THREE.Color(0x009eb2);
        
        var camera = new THREE.PerspectiveCamera(90,  window.innerWidth / window.innerHeight, 0.1, 1000);
        var renderer = new THREE.WebGLRenderer({
            antialias:false
        });
        
        var player = { 
            height:1.8, //camera y
            speed:0.2,  //movement speed
            turnSpeed:Math.PI*0.02 //turning speed
        };
        
        var mixer;
        var clock = new THREE.Clock();
        
        
       
        
        function init(){
            makeLight();
            makeFloor();
            makeRoad();
            makePatrickHouse();
            makeModels();
            camera.position.set(0, player.height, -5);
            camera.lookAt(new THREE.Vector3(0,player.height,0));

            renderer.setSize( window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);

            animate();
        }
        
        /** MODEL **/
        function makeModels(){
            var loader = new THREE.GLTFLoader();
            
            //TEST SPONGEBOB
//            loader.load( 'models/scene.gltf', function ( gltf ) {
//                var texture = new THREE.TextureLoader().load( 'models/textures/spongebob_baseColor.png' );
//                texture.encoding = THREE.sRGBEncoding;
//                scene.add( gltf.scene );
//
//            }, undefined, function ( error ) {
//
//                console.error( error );
//
//            } );
            
            //SPONGEBOB
            loader.load( 'models/spongebob.glb', function ( gltf ) {
                var model = gltf.scene;
                model.scale.set(.45, .45, .45);

                model.rotation.y -= Math.PI /2;
                model.position.set(4 ,0.75, 6);
                scene.add(model);
            }, undefined, function ( error ) {

                console.error( error );

            } );
            
            
            //PATRICK
            loader.load( 'models/Patrick.glb', function ( gltf ) {
                var model = gltf.scene;
                model.scale.set(.7, .7, .7);

                model.rotation.y -= Math.PI;
                model.position.set(8,0,5);
                scene.add(model);
                
                mixer = new THREE.AnimationMixer(model);
                mixer.clipAction(gltf.animations[0]).play();
            }, undefined, function ( error ) {

                console.error( error );

            } );
            
            //PINEAPPLE
            loader.load( 'models/Pineapple.glb', function ( gltf ) {
                var model = gltf.scene;
                model.scale.set(5, 5, 5);
//
//                model.rotation.y -= Math.PI;
                model.position.set(0,-1,20);
                scene.add(model);
            }, undefined, function ( error ) {

                console.error( error );

            } );
        }
        
        function makeLight(){
            var ambientLight = new THREE.AmbientLight(0xffffff, 1);
            scene.add(ambientLight);
            
            var pointLight = new THREE.PointLight(0xffffff, 3);
            pointLight.position.set(-10, 50, 20);
            scene.add(pointLight);
            
            var sphereSize = 6;
            var pointLightHelper = new THREE.PointLightHelper( pointLight, sphereSize );
            scene.add( pointLightHelper );
        }
        
        function makeFloor(){
            var floorGeometry =  new THREE.PlaneGeometry(500,500,64);
            var material =  new THREE.MeshPhongMaterial({
                            color:0x494b2d,
                            shininess: 0
            });
            var floor = new THREE.Mesh(floorGeometry, material);
            
            floor.rotation.x -= Math.PI / 2; // Rotate the floor
            scene.add(floor);
        }
        
        function makeRoad(){
            var roadGeometry = new THREE.PlaneGeometry(500, 10, 10);
            var material =  new THREE.MeshPhongMaterial({
                            color:0x242424,
                            shininess: 0
            });
            var road = new THREE.Mesh(roadGeometry, material);
            
            road.rotation.x -= Math.PI / 2; // Rotate the floor
            road.position.y += 0.03;
            scene.add(road);
        }
        
        function makePatrickHouse(){
            var sphereGeometry = new THREE.SphereGeometry(8, 32, 32);
            var material =  new THREE.MeshPhongMaterial({
//                            color:0x4b010f,
                            map:THREE.ImageUtils.loadTexture('models/textures/rock_texture.jpg')
            });
            var patrickHouse = new THREE.Mesh(sphereGeometry, material);
            patrickHouse.position.x = 15;
            patrickHouse.position.z = 20;
            patrickHouse.position.y = 0;
            scene.add(patrickHouse);
            
            var pathGeometry = new THREE.PlaneGeometry(5, 18, 10);
            var material =  new THREE.MeshPhongMaterial({
                            color:0x242424,
                            shininess: 0
            });
            var patrickPath = new THREE.Mesh(pathGeometry, material);
            var spongebobPath = new THREE.Mesh(pathGeometry, material);
            
            patrickPath.rotation.x -= Math.PI / 2; // Rotate the floor
            patrickPath.position.x = 15;
            patrickPath.position.z = 10;
            patrickPath.position.y += 0.03;
            
            spongebobPath.rotation.x -= Math.PI / 2
            spongebobPath.position.x = 0;
            spongebobPath.position.z = 10;
            spongebobPath.position.y += 0.03;
            
            
            scene.add(patrickPath);
            scene.add(spongebobPath);
        }

        function animate(){
            requestAnimationFrame(animate);

            // Keyboard movement inputs
//          if(keyboard[87] && ((camera.position.x <= 250 && camera.position.x >= -250) && (camera.position.z <= 250 && camera.position.z >= -250))){ // W with checking for collision DOES NOT WORK YET
            if(keyboard[87]){ // W
                camera.position.x -= Math.sin(camera.rotation.y) * player.speed;
                camera.position.z -= -Math.cos(camera.rotation.y) * player.speed;
            }
            if(keyboard[83]){ // S
                camera.position.x += Math.sin(camera.rotation.y) * player.speed;
                camera.position.z += -Math.cos(camera.rotation.y) * player.speed;
            }
            if(keyboard[65]){ // A
                camera.rotation.y -= player.turnSpeed;
            }
            if(keyboard[68]){ // D
                camera.rotation.y += player.turnSpeed;
            }
            
            //patrick animation
            var delta = clock.getDelta();
            if (mixer != null) {
                mixer.update(delta);
            };
            
            renderer.render(scene, camera);
        }

        var keyboard = {};
        
        function keyDown(event){
            keyboard[event.keyCode] = true;
        }

        function keyUp(event){
            keyboard[event.keyCode] = false;
        }

        window.addEventListener('keydown', keyDown);
        window.addEventListener('keyup', keyUp);

        init();
    </script>
</body>
</html>